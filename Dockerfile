# Dependencies stage`nFROM node:20-alpine AS deps`nWORKDIR /app`n`n# Copy package files`nCOPY package.json package-lock.json ./`n`n# Install dependencies`nRUN npm ci`n`n# Builder stage`nFROM node:20-alpine AS builder`nWORKDIR /app`n`n# Copy dependencies from deps stage`nCOPY --from=deps /app/node_modules ./node_modules`n`n# Copy all files`nCOPY . .`n`n# Build the application`nRUN npm run build`n`n# Runner stage`nFROM node:20-alpine AS runner`nWORKDIR /app`n`nENV NODE_ENV=production`n`n# Create non-root user`nRUN addgroup --system --gid 1001 nodejs`nRUN adduser --system --uid 1001 nextjs`n`n# Copy built files`nCOPY --from=builder /app/public ./public`nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./`nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static`n`n# Switch to non-root user`nUSER nextjs`n`n# Expose port`nEXPOSE 3000`n`nENV PORT=3000`nENV HOSTNAME="0.0.0.0"`n`n# Start the application`nCMD ["node", "server.js"]
